<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>个人资料</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=2.0, user-scalable=yes" />
<link href="{laoyang::RES}/css/userinfo/fans.css" rel="stylesheet" type="text/css"> 

<script src="{laoyang::$staticFilePath}/js/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">window.jQuery || document.write('<script type="text/javascript" src="{laoyang::RES}/css/guajiang/js/jquery.js">\x3C/script>')</script>
<script src="/tpl/static/artDialog/jquery.artDialog.js?skin=default"></script>
<script src="/tpl/static/artDialog/plugins/iframeTools.js"></script>
<script src="/tpl/static/upyun.js?2013"></script>

<style>

.footFix{width:100%;text-align:center;position:fixed;left:0;bottom:0;z-index:99;}
#footReturn a, #footReturn2 a {
display: block;
line-height: 41px;
color: #fff;
text-shadow: 1px 1px #282828;
font-size: 14px;
font-weight: bold;
}
#footReturn, #footReturn2 {
z-index: 89;
display: inline-block;
text-align: center;
text-decoration: none;
vertical-align: middle;
cursor: pointer;
width: 100%;
outline: 0 none;
overflow: visible;
Unknown property name.-moz-box-sizing: border-box;
box-sizing: border-box;
padding: 0;
height: 41px;
opacity: .95;
border-top: 1px solid #181818;
box-shadow: inset 0 1px 2px #b6b6b6;
background-color: #515151;
Invalid property value.background-image: -ms-linear-gradient(top,#838383,#202020);
background-image: -webkit-linear-gradient(top,#838383,#202020);
Invalid property value.background-image: -moz-linear-gradient(top,#838383,#202020);
Invalid property value.background-image: -o-linear-gradient(top,#838383,#202020);
background-image: -webkit-gradient(linear,0% 0,0% 100%,from(#838383),to(#202020));
Invalid property value.filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#838383',endColorstr='#202020');
Unknown property name.-ms-filter: progid:DXImageTransform.Microsoft.gradient(GradientType=0,startColorstr='#838383',endColorstr='#202020');
}
.btn_code {
float: right;
line-height: 35px;
text-align: center;
display: inline-block;
margin: 3px 3px 3px;
width: 80px;
color: #6d6d6d;
border: 1px solid #d1d1d1;
background-color: #e6e6e6;
background-image: -webkit-gradient(linear,left top,left bottom,from(#f8f8f8),to(#e6e6e6));
background-image: -webkit-linear-gradient(top,#f8f8f8,#e6e6e6);
background-image: linear-gradient(to bottom,#f8f8f8,#e6e6e6);
border-radius: 5px;
}
.prx {
position: relative;
background-color: transparent;
color: #999999;
width: 57%;
padding: 10px;
font-size: 16px;
margin: 0 auto;
font-family: Arial, Helvetica, sans-serif;
border: 0;
-webkit-appearance: none;
}
</style>
</head>
<body id="fans" >
<div class="qiandaobanner"> <img src="{laoyang:$homepic}" > </div>
<div class="cardexplain">
<li class="nob">
<div class="beizhu"><?php if ($cardid){?><if condition="$cardInfo neq false">您可以修改你的会员卡信息。以下信息将作为消费凭证，请认真填写！ <else/>填写以下信息即可领取vip会员卡,红色字必填 </if><?php }else {echo '请先完善您的个人信息，红色为必填项';}?></div>
</li>
<ul class="round">
<if condition="$cardInfo neq false">
	<li>
	<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
	<tr>
	<th><font color='red'>会员卡号</font></th>
	<td><input  type="text" class="px" readonly value="{laoyang:$cardnum}"></td>
	</tr>
	</table>
	</li>
</if>
<li>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th><font color='red'>微信昵称</font></th>
<td><input name="wechaname" onfocus="check2(this)" onblur="check1(this)"  type="text" class="px" id="wechaname" value="{laoyang:$fans.wechaname}" placeholder="请输入您的微信名称"></td>
</tr>
</table>
</li>
<li>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th><font color='red'>手机号码</font></th>
<td><input onfocus="check2(this)" onblur="check3(this)" name="tel"  class="px" id="tel" value="{laoyang:$info.tel}"  type="text" placeholder="请输入您的电话"></td>
</tr>
</table>
</li>
<if condition="$thisCard['mobile_code_dis'] eq 1">
<li>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th><font color='red'>短信验证</font></th>
<td><input onfocus="check2(this)" name="mobile_code"  class="prx" id="mobile_code" value=""  type="text" placeholder="请输入验证码"><input id="zphone" type="button" class="btn_code" value=" 获取验证码 " onclick="get_mobile_code();"></td>
</tr>
</table>
</li>
</if>
<if condition="$thisCard['truename_dis'] eq 1">
<li>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th>真实姓名</th>
<td><input onfocus="check2(this)" onblur="check4(this)"  name="truename"  type="text" class="px" id="truename" value="{laoyang:$info.truename}" placeholder="请输入您的真实姓名"></td>
</tr>
</table>
</li>
</if>
<if condition="$thisCard['qq_dis'] eq 1">
<li>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th>QQ号码</th>
<td><input name="qq"  class="px" id="qq" value="{laoyang:$info.qq}"  type="text" placeholder="请输入您的QQ号码"></td>
</tr>
</table>
</li>
</if>
<if condition="$thisCard.diyname1 neq ''">
<li>

<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">

<tr>

<th>{laoyang:$thisCard.diyname1} </th>

<td><input name="diy1_value"  class="px" id="diy1_value" value="{laoyang:$info.diy1_value}"  type="text" placeholder="请输入您的{laoyang:$thisCard.diyname1}"></td>

</tr>

</table>

</li>
</if>
<if condition="$thisCard.diyname2 neq ''">
<li>

<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">

<tr>

<th>{laoyang:$thisCard.diyname2} </th>

<td><input name="diy2_value"  class="px" id="diy2_value" value="{laoyang:$info.diy2_value}"  type="text" placeholder="请输入您的{laoyang:$thisCard.diyname2}"></td>

</tr>

</table>

</li>
</if>
<li>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th>支付密码</th>
<td><input name="paypass"  class="px" id="paypass" value=""  type="password" placeholder="请输入您的支付密码"></td>
</tr>
</table>
</li>
</ul>
<ul class="round">
<li>
<style>
.por{width:65px;float:left;height:65px;}
.por img{width:60px;height:60px;cursor:pointer}
.por img.selected{border:2px solid #f60}
</style>
<script>
function selectpor(el){
	$("#portrait").val(el.src);
	$('#pors img').removeClass('selected');
	$('#portrait_src').attr('src',el.src);
	el.className='selected';
}
</script>
<div style="padding:10px 10px 10px 0;">请设置头像</div>
<input type="hidden" value="{laoyang:$info.portrait}" id="portrait" name="portrait" size="80" />
 <a href="###" onclick="upyunWapPicUpload('portrait',200,200,'{laoyang:$Think.get.token}')" class="a_upload" style="color:red">点击这里上传</a>
<div class="por"><img src="<laoyangif where="$fans.portrait neq ''">{laoyang:$fans.portrait}<else/>/tpl/User/default/common/images/portrait.jpg</laoyangif>" id="portrait_src" /></div>
<div style="clear:both"></div>
或者选择下面头像
<div style="margin:10px 0 20px 0" id="pors">
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/1.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/2.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/3.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/4.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/5.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/6.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/7.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/8.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/9.jpg" /></div>
<div class="por"><img onclick="selectpor(this)" src="/tpl/static/portrait/10.jpg" /></div>
<div style="clear:both"></div>
</div>
</li>

</ul>
<ul class="round">
<if condition="$thisCard['sex_dis'] eq 1">
<li>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th>性别</th>
<td><select name="sex" class="dropdown-select" id="sex">
<option  class="dropdown-option">请选择你的性别</option>
<option  value="1" <if condition="$info['sex'] eq 1">selected</if>>男</option>
<option  value="2" <if condition="$info['sex'] eq 2">selected</if>> 女</option>
</select></td>
</tr>
</table>
</li>
</if>
<if condition="$thisCard['bornyear_dis'] eq 1">
<li>
<table width="100%" height='40px' border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th>出生年</th>
<td>
<select name="bornyear" class="dropdown-select" id="bornyear" >
	<option value="0">请选择</option>
	<?php for($i=1949;$i<=2020;$i++){ ?>
		<option value="<?=$i?>" <if condition="$info['bornyear'] eq $i">selected</if>><?=$i?></option>
	<?php }?>	
</select>
</td>
</tr>
</table>
</li>
</if>
<if condition="$thisCard['bornmonth_dis'] eq 1">
<li>
<table width="100%" height='40px' border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th>出生月</th>
<td>
<select name="bornmonth" class="dropdown-select" id="bornmonth" >
	<option value="0">请选择</option>
	<?php for($i=1;$i<=12;$i++){ ?>
		<option value="<?=$i?>" <if condition="$info['bornmonth'] eq $i">selected</if>><?=$i?></option>
	<?php }?>	
</select>
</td>
</tr>
</table>
</li>
</if>
<if condition="$thisCard['bornday_dis'] eq 1">
<li>
<table width="100%" height='40px' border="0" cellspacing="0" cellpadding="0" class="kuang">
<tr>
<th>出生日</th>
<td>
<select name="bornday" class="dropdown-select" id="bornday" >
	<option value="0">请选择</option>
	<?php
	$day=date('t',time());
	for($i=1;$i<=$day;$i++){ ?>
		<option value="<?=$i?>" <if condition="$info['bornday'] eq $i">selected</if>><?=$i?></option>
	<?php }?>	
</select>
</td>
</tr>
</table>
</li>
</if>
</ul>

<div class="footReturn">
<a id="showcard"  class="submit" >提交信息</a>
<div class="window" id="windowcenter" >
<div id="title" class="wtitle"><span class="close" id="alertclose"></span></div>
<div class="content">
<div id="txt"></div>
</div>
</div>
</div>
<div style="height:60px;" id="msg">&nbsp;</div>
<script language="javascript">
	function get_mobile_code(){
		var tel = $("#tel").val();
		var reg=/^13[0-9]{1}[0-9]{8}$|17[0678]{1}[0-9]{8}$|15[012356789]{1}[0-9]{8}$|18[012356789]{1}[0-9]{8}$/i;
        if(reg.test(tel))
		{
			$.post('index.php?g=Wap&m=Userinfo&a=getcode&token={laoyang:$Think.get.token}&wecha_id={laoyang:$Think.get.wecha_id}&cardid={laoyang:$Think.get.cardid}', {mobile:$("#tel").val(),send_code:<?php echo $_SESSION['send_code'];?>}, function(msg) {
				alert(jQuery.trim(unescape(msg)));
				RemainTime();
			});
		}
		else
		{
		   alert("手机号错误");
		}

	};
	var iTime = 59;
	var Account;
	function RemainTime(){
		document.getElementById('zphone').disabled = true;
		var iSecond,sSecond="",sTime="";
		if (iTime >= 0){
			iSecond = parseInt(iTime%60);
			iMinute = parseInt(iTime/60)
			if (iSecond >= 0){
				if(iMinute>0){
					sSecond = iMinute + "分" + iSecond + "秒";
				}else{
					sSecond = iSecond + "秒后重试";
				}
			}
			sTime=sSecond;
			if(iTime==0){
				clearTimeout(Account);
				sTime='获取验证码';
				iTime = 59;
				document.getElementById('zphone').disabled = false;
			}else{
				Account = setTimeout("RemainTime()",1000);
				iTime=iTime-1;
			}
		}else{
			sTime='没有倒计时';
		}
		document.getElementById('zphone').value = sTime;
	}	
</script>
<script type="text/javascript">

$("#showcard").bind("click",
function() {
    var btn = $(this);
    var wechaname = $("#wechaname").val();
	<if condition="$thisCard['mobile_code_dis'] eq 1">	
	var mobile_code = $("#mobile_code").val();
	</if>
	var tel 	  = $("#tel").val();
	<if condition="$thisCard['truename_dis'] eq 1">
	var truename  = $("#truename").val();
	</if>
	<if condition="$thisCard['qq_dis'] eq 1">
	var qq 		  = $("#qq").val();
	</if>
	<if condition="$thisCard['sex_dis'] eq 1">
	var sex 	  = $("#sex").val();
	</if>
	<if condition="$thisCard['bornyear_dis'] eq 1">
	var bornyear       = $("#bornyear").val();
	</if>
	<if condition="$thisCard['bornmonth_dis'] eq 1">
	var bornmonth       = $("#bornmonth").val();
	</if>
	<if condition="$thisCard['bornday_dis'] eq 1">
	var bornday       = $("#bornday").val();
	</if>
	var portrait       = $("#portrait").val();
	<if condition="$thisCard.diyname1 neq ''">
	var diy1_value       = $("#diy1_value").val();
		<if condition="$thisCard.diyname1 eq '身份证'">
		if (!IdCardValidate(diy1_value))
		{
			alert("亲，请填写正确的身份证号");
			return
		}
		</if>
	    if (diy1_value == '') {
        alert("亲，请认真填完相关信息哦");
        return
    }
	</if>
	var paypass       = $("#paypass").val();
	<if condition="$thisCard.diyname2 neq ''">
	var diy2_value       = $("#diy2_value").val();
		<if condition="$thisCard.diyname2 eq '身份证'">
		if (!IdCardValidate(diy2_value))
		{
			alert("亲，请填写正确的身份证号");
			return
		}
		</if>
	    if (diy2_value == '') {
        alert("亲，请认真填完相关信息哦");
        return
    }
	</if>

    if (tel == '') {
        alert("请认真输入手机号");
        return
    }
     if (truename == '') {
        alert("请认真输入真实姓名");
        return
    }   
    if (wechaname == '') {
        alert("请认真输入微信号");
        return
    }
	<if condition="$thisCard['mobile_code_dis'] eq 1">		
    if (mobile_code == '') {
        alert("请输入验证码");
        return
    }
   </if>
    var submitData = {
		<if condition="$thisCard['mobile_code_dis'] eq 1">		
		mobile_code : mobile_code,
		</if>
        wechaname : wechaname,
        tel 	  : tel,
		<if condition="$thisCard['truename_dis'] eq 1">
        truename  : truename,
		</if>
		<if condition="$thisCard['qq_dis'] eq 1">
        qq        : qq,
		</if>
		<if condition="$thisCard['sex_dis'] eq 1">
        sex 	  : sex,
		</if>
		<if condition="$thisCard['bornyear_dis'] eq 1">
        bornyear  : bornyear,
		</if>
		<if condition="$thisCard['bornmonth_dis'] eq 1">
        bornmonth : bornmonth,
		</if>
		<if condition="$thisCard['bornday_dis'] eq 1">
        bornday   : bornday,
		</if>
        cardid 	  : {laoyang:$cardid},
		paypass   : paypass,
        portrait  : portrait,
		<if condition="$thisCard.diyname1 neq ''">
		diy1_value  : diy1_value,
		</if>
		 <if condition="$thisCard.diyname2 neq ''">
		diy2_value  : diy2_value,
		</if>
        action: "index"
    };
    $.post('index.php?g=Wap&m=Userinfo&a=index&token={laoyang:$Think.get.token}&wecha_id={laoyang:$Think.get.wecha_id}&cardid={laoyang:$Think.get.cardid}', submitData,
    function(data) {
        if(data==1){			 
			alert('个人信息保存成功');
			<?php if ($redirectUrl){?>location.href = "{laoyang:$redirectUrl}";<?php }?>
		}else if(data==2){
			alert('成功领取了会员卡');
			location.href = "{laoyang::U('Card/card',array('token'=>$_GET['token'],'wecha_id'=>$_GET['wecha_id'],'cardid'=>$_GET['cardid']))}";
		}else if(data==3){
			 
			alert('该商家会员卡缺货了');
		}else if(data==4){
			 
			alert('您的积分不够领取改会员卡');
		}else if(data==5){
			 
			alert('验证码不正确');
		}else{
			alert('稍后再试.');
		}
    },
    "json")
});
<if condition="$thisCard['wechaname_dis'] eq 1">
function check1(obj){	 
	if(obj.value == ''){
		alert("请输入您的微信名称.");
		document.getElementById(obj.id).style.background="red";
		return;
	}
}
</if>
<if condition="$thisCard['truename_dis'] eq 1">
function check4(obj){	 
	if(obj.value == ''){
		alert("请认真输入真实姓名.");
		document.getElementById(obj.id).style.background="red";
		return;
	}
}
</if>
function check2(obj){   
  	document.getElementById(obj.id).style.background="white";  
}
<if condition="$thisCard['tel_dis'] eq 1">
function check3(obj){
	if(obj.value == ''){
		alert('手机号码必须填写');
		document.getElementById(obj.id).style.background="red";
		return;
	}
	reg=/^0{0,1}(13[0-9]|145|15[0-9]|18[0-9])[0-9]{8}$/i;
	  if(!reg.test(obj.value)){   
			alert("错误,请输入11位的手机号！");
			document.getElementById(obj.id).style.background="red";
			return;
	 }
}
</if>
var Wi = [ 7, 9, 10, 5, 8, 4, 2, 1, 6, 3, 7, 9, 10, 5, 8, 4, 2, 1 ];    // 加权因子   
var ValideCode = [ 1, 0, 10, 9, 8, 7, 6, 5, 4, 3, 2 ];            // 身份证验证位值.10代表X   
function IdCardValidate(idCard) { 
    idCard = trim(idCard.replace(/ /g, ""));               //去掉字符串头尾空格                     
    if (idCard.length == 15) {   
        return isValidityBrithBy15IdCard(idCard);       //进行15位身份证的验证    
    } else if (idCard.length == 18) {   
        var a_idCard = idCard.split("");                // 得到身份证数组   
        if(isValidityBrithBy18IdCard(idCard)&&isTrueValidateCodeBy18IdCard(a_idCard)){   //进行18位身份证的基本验证和第18位的验证
            return true;   
        }else {   
            return false;   
        }   
    } else {   
        return false;   
    }   
}   
/**  
 * 判断身份证号码为18位时最后的验证位是否正确  
 * @param a_idCard 身份证号码数组  
 * @return  
 */  
function isTrueValidateCodeBy18IdCard(a_idCard) {   
    var sum = 0;                             // 声明加权求和变量   
    if (a_idCard[17].toLowerCase() == 'x') {   
        a_idCard[17] = 10;                    // 将最后位为x的验证码替换为10方便后续操作   
    }   
    for ( var i = 0; i < 17; i++) {   
        sum += Wi[i] * a_idCard[i];            // 加权求和   
    }   
    valCodePosition = sum % 11;                // 得到验证码所位置   
    if (a_idCard[17] == ValideCode[valCodePosition]) {   
        return true;   
    } else {   
        return false;   
    }   
}   
/**  
  * 验证18位数身份证号码中的生日是否是有效生日  
  * @param idCard 18位书身份证字符串  
  * @return  
  */  
function isValidityBrithBy18IdCard(idCard18){   
    var year =  idCard18.substring(6,10);   
    var month = idCard18.substring(10,12);   
    var day = idCard18.substring(12,14);   
    var temp_date = new Date(year,parseFloat(month)-1,parseFloat(day));   
    // 这里用getFullYear()获取年份，避免千年虫问题   
    if(temp_date.getFullYear()!=parseFloat(year)   
          ||temp_date.getMonth()!=parseFloat(month)-1   
          ||temp_date.getDate()!=parseFloat(day)){   
            return false;   
    }else{   
        return true;   
    }   
}   
  /**  
   * 验证15位数身份证号码中的生日是否是有效生日  
   * @param idCard15 15位书身份证字符串  
   * @return  
   */  
  function isValidityBrithBy15IdCard(idCard15){   
      var year =  idCard15.substring(6,8);   
      var month = idCard15.substring(8,10);   
      var day = idCard15.substring(10,12);   
      var temp_date = new Date(year,parseFloat(month)-1,parseFloat(day));   
      // 对于老身份证中的你年龄则不需考虑千年虫问题而使用getYear()方法   
      if(temp_date.getYear()!=parseFloat(year)   
              ||temp_date.getMonth()!=parseFloat(month)-1   
              ||temp_date.getDate()!=parseFloat(day)){   
                return false;   
        }else{   
            return true;   
        }   
  }   
//去掉字符串头尾空格   
function trim(str) {   
    return str.replace(/(^\s*)|(\s*$)/g, "");   
}
</script>
</div>
<script type="text/javascript">
window.shareData = {  
            "moduleName":"Index",
            "moduleID":"0",
            "imgUrl": "", 
            "sendFriendLink": "{laoyang:$f_siteUrl}{laoyang::U('Index/index',array('token'=>$token))}",
            "tTitle": "",
            "tContent": ""
};
</script>
{laoyang:$shareScript}
</body>
</html>
